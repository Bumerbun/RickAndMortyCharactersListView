import{_ as w}from"./nuxt-link.475e700c.js";import{u as h}from"./useApiStore.75cb57b1.js";import{n as v,q as x,_ as P,c as l,a as i,u as f,v as F,x as y,F as d,s as _,o as c,t as u,b as m,w as N,p as C,e as E}from"./entry.0b376df6.js";const b=v("characterList",{state:()=>({characters:[],_filter:null,_nextpage:null,_previouspage:null}),actions:{async _getPageData(t){const s=(await h().get(t)).data;for(let o=0;o<s.results.length;o++)s.results[o].episode=(await this._parseEpisodes(s.results[o].episode)).splice(0,5);return s},async _parseEpisodes(t){const e=[];for(let s=0;s<t.length;s++)e.push(await this._getEpisodeData(t[s]));return e},async _getEpisodeData(t){const s=(await h().get(t)).data;return(({name:o,episode:r,id:n})=>({name:o,episode:r,id:n}))(s)},async _getNextPage(){if(this.characters.length==0)try{return this._getPageData(`/character?${this._filter}`)}catch(t){return console.log(t.message),null}return this._nextpage?this._getPageData(this._nextpage):null},async _getPreviousPage(){return this._previouspage?this._getPageData(this._previouspage):null},async appendNextPage(){var e,s;const t=await this._getNextPage();t&&(this._nextpage=(e=t.info)==null?void 0:e.next,this._previouspage=(s=t.info)==null?void 0:s.prev,this.characters.push(...t.results))},_selectPage(t){var e,s;t&&(this.characters=t.results,this._nextpage=(e=t.info)==null?void 0:e.next,this._previouspage=(s=t.info)==null?void 0:s.prev)},async selectNextPage(){this._selectPage(await this._getNextPage())},async selectPreviousPage(){this._selectPage(await this._getPreviousPage())},setFilter(t){this._filter=t,this.characters=[],this._nextpage=null,this._previouspage=null},reset(){this._filter=null,this.characters=[],this._nextpage=null,this._previouspage=null}},persist:{storage:x.localStorage}}),D=v("filtrationOptions",{state:()=>({name:"",status:""}),persist:{storage:x.localStorage}}),O={mounted(){window.onscroll=()=>this.onScroll(),this.characters.length==0&&this.appendCharacters()},data(){return{apiStore:h(),charactersStore:b(),selectedFiltration:D(),statusOptions:["","alive","dead","unknown"]}},computed:{characters(){return this.charactersStore.characters}},methods:{async updateFiltration(){this.charactersStore.setFilter(`name=${this.selectedFiltration.name}&status=${this.selectedFiltration.status}`),await this.charactersStore.appendNextPage()},resetCharacters(){this.charactersStore.reset()},async appendCharacters(){await this.charactersStore.appendNextPage()},onScroll(){Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight===document.documentElement.offsetHeight&&this.appendCharacters()}}};const S=t=>(C("data-v-46c9e37f"),t=t(),E(),t),k={class:"filtration_options"},I={class:"filtration_option"},L=S(()=>i("label",{for:"name_input"},"Имя: ",-1)),V={class:"filtration_option"},B=S(()=>i("label",{for:"status_select",class:"filtration_label"},"Статус: ",-1)),M=["value","selected"],T={class:"character_cards_list"},H={class:"card"},U=["src"],W={class:"episode_row"},q={class:"episode_name"},A={class:"episode"};function Y(t,e,s,o,r,n){const g=w;return c(),l("div",null,[i("div",k,[i("div",I,[L,f(i("input",{type:"search",ref:"name_input","onUpdate:modelValue":e[0]||(e[0]=a=>r.selectedFiltration.name=a),onInput:e[1]||(e[1]=(...a)=>n.updateFiltration&&n.updateFiltration(...a))},null,544),[[F,r.selectedFiltration.name]])]),i("div",V,[B,f(i("select",{ref:"status_select",class:"selection_menu","onUpdate:modelValue":e[2]||(e[2]=a=>r.selectedFiltration.status=a),onChange:e[3]||(e[3]=(...a)=>n.updateFiltration&&n.updateFiltration(...a))},[(c(!0),l(d,null,_(r.statusOptions,a=>(c(),l("option",{value:a,class:"selection_option",selected:a==r.selectedFiltration.status},u(a),9,M))),256))],544),[[y,r.selectedFiltration.status]])])]),i("div",T,[(c(!0),l(d,null,_(n.characters,a=>(c(),l("div",H,[m(g,{to:`/character?id=${a.id}`},{default:N(()=>[i("h2",null,u(a.name),1),i("p",null,"Разновидность: "+u(a.species),1),i("img",{class:"card_image",src:a.image},null,8,U)]),_:2},1032,["to"]),i("div",null,[(c(!0),l(d,null,_(a.episode,p=>(c(),l("div",W,[m(g,{class:"link_fill",to:`/episode?id=${p.id}`},null,8,["to"]),i("div",q,u(p.name),1),i("div",A,u(p.episode),1)]))),256))])]))),256))])])}const J=P(O,[["render",Y],["__scopeId","data-v-46c9e37f"]]);export{J as default};
