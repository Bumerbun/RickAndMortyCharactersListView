import{_ as F}from"./nuxt-link.e20bce2b.js";import{u as g,_ as y}from"./useApiStore.5512a3c4.js";import{n as x,q as S,_ as b,c as l,a as i,u as f,v as C,x as N,F as _,s as d,b as h,w as v,o as c,t as u,p as E,e as O}from"./entry.7c67f8e4.js";const D=x("characterList",{state:()=>({characters:[],_filter:null,_nextpage:null,_previouspage:null}),actions:{async _getPageData(t){const s=(await g().get(t)).data;for(let o=0;o<s.results.length;o++)s.results[o].episode=(await this._parseEpisodes(s.results[o].episode)).splice(0,5);return s},async _parseEpisodes(t){const e=[];for(let s=0;s<t.length;s++)e.push(await this._getEpisodeData(t[s]));return e},async _getEpisodeData(t){const s=(await g().get(t)).data;return(({name:o,episode:n,id:r})=>({name:o,episode:n,id:r}))(s)},async _getNextPage(){if(this.characters.length==0)try{return this._getPageData(`/character?${this._filter}`)}catch(t){return console.log(t.message),null}return this._nextpage?this._getPageData(this._nextpage):null},async _getPreviousPage(){return this._previouspage?this._getPageData(this._previouspage):null},async appendNextPage(){var e,s;const t=await this._getNextPage();t&&(this._nextpage=(e=t.info)==null?void 0:e.next,this._previouspage=(s=t.info)==null?void 0:s.prev,this.characters.push(...t.results))},_selectPage(t){var e,s;t&&(this.characters=t.results,this._nextpage=(e=t.info)==null?void 0:e.next,this._previouspage=(s=t.info)==null?void 0:s.prev)},async selectNextPage(){this._selectPage(await this._getNextPage())},async selectPreviousPage(){this._selectPage(await this._getPreviousPage())},setFilter(t){this._filter=t,this.characters=[],this._nextpage=null,this._previouspage=null},reset(){this._filter=null,this.characters=[],this._nextpage=null,this._previouspage=null}},persist:{storage:S.localStorage}}),k=x("filtrationOptions",{state:()=>({name:"",status:""}),persist:{storage:S.localStorage}}),I={mounted(){window.onscroll=()=>this.onScroll(),this.characters.length==0&&this.appendCharacters()},data(){return{apiStore:g(),charactersStore:D(),selectedFiltration:k(),statusOptions:["","alive","dead","unknown"]}},computed:{characters(){return this.charactersStore.characters}},methods:{async updateFiltration(){this.charactersStore.setFilter(`name=${this.selectedFiltration.name}&status=${this.selectedFiltration.status}`),await this.charactersStore.appendNextPage()},resetCharacters(){this.charactersStore.reset()},async appendCharacters(){await this.charactersStore.appendNextPage()},onScroll(){Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight===document.documentElement.offsetHeight&&this.appendCharacters()}}};const w=t=>(E("data-v-b192a9e1"),t=t(),O(),t),L={class:"filtration_options"},V={class:"filtration_option"},B=w(()=>i("label",{for:"name_input"},"Имя: ",-1)),M={class:"filtration_option"},T=w(()=>i("label",{for:"status_select",class:"filtration_label"},"Статус: ",-1)),H=["value","selected"],U={class:"character_cards_list"},W={class:"card"},q=["src"],A={class:"episode_row"},Y={class:"episode_name"},j={class:"episode"};function z(t,e,s,o,n,r){const m=F,P=y;return c(),l("div",null,[i("div",L,[i("div",V,[B,f(i("input",{type:"search",ref:"name_input","onUpdate:modelValue":e[0]||(e[0]=a=>n.selectedFiltration.name=a),onInput:e[1]||(e[1]=(...a)=>r.updateFiltration&&r.updateFiltration(...a))},null,544),[[C,n.selectedFiltration.name]])]),i("div",M,[T,f(i("select",{ref:"status_select",class:"selection_menu","onUpdate:modelValue":e[2]||(e[2]=a=>n.selectedFiltration.status=a),onChange:e[3]||(e[3]=(...a)=>r.updateFiltration&&r.updateFiltration(...a))},[(c(!0),l(_,null,d(n.statusOptions,a=>(c(),l("option",{value:a,class:"selection_option",selected:a==n.selectedFiltration.status},u(a),9,H))),256))],544),[[N,n.selectedFiltration.status]])])]),i("div",U,[h(P,null,{default:v(()=>[(c(!0),l(_,null,d(r.characters,a=>(c(),l("div",W,[h(m,{to:`/character?id=${a.id}`},{default:v(()=>[i("h2",null,u(a.name),1),i("p",null,"Разновидность: "+u(a.species),1),i("img",{class:"card_image",src:a.image},null,8,q)]),_:2},1032,["to"]),i("div",null,[(c(!0),l(_,null,d(a.episode,p=>(c(),l("div",A,[h(m,{class:"link_fill",to:`/episode?id=${p.id}`},null,8,["to"]),i("div",Y,u(p.name),1),i("div",j,u(p.episode),1)]))),256))])]))),256))]),_:1})])])}const Q=b(I,[["render",z],["__scopeId","data-v-b192a9e1"]]);export{Q as default};
